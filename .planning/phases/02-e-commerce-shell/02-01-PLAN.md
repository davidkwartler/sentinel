---
phase: 02-e-commerce-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(shop)/profile/page.tsx
autonomous: true
requirements:
  - SHOP-01
  - SHOP-02

must_haves:
  truths:
    - "Authenticated user can navigate to /products and see a grid of 8 mock products"
    - "Authenticated user can navigate to /profile and see their name, email, and avatar from OAuth"
    - "Both /products and /profile are unreachable without authentication"
    - "profile/page.tsx does not contain a redundant auth null guard (dead code removed)"
  artifacts:
    - path: "src/app/(shop)/layout.tsx"
      provides: "Route group auth gate — calls auth() once, redirects to /login if null; shared nav with Products, Profile, Sign Out"
      contains: "if (!session) { redirect"
    - path: "src/app/(shop)/products/page.tsx"
      provides: "8 mock products in responsive 2/3/4-column grid — no auth() call (layout guarantees auth)"
      contains: "grid-cols-2"
    - path: "src/app/(shop)/profile/page.tsx"
      provides: "User identity display (name, email, avatar) from OAuth session — auth() for data only, no null guard"
      contains: "const { user } = session!"
  key_links:
    - from: "proxy.ts"
      to: "src/app/(shop)/layout.tsx"
      via: "Next.js 16 proxy intercepts all matched routes; layout's auth() is the definitive session check for the (shop) group"
      pattern: "auth as proxy"
    - from: "src/app/(shop)/layout.tsx"
      to: "src/app/(shop)/profile/page.tsx"
      via: "Layout auth() + redirect runs before page renders — page-level null guard is unreachable dead code"
      pattern: "auth\\(\\)"
---

<objective>
Remove the redundant auth null guard from profile/page.tsx. The phase is already built; this is the single quality improvement identified in research.

Purpose: The (shop)/layout.tsx and proxy.ts both enforce auth before profile/page.tsx renders. The page-level `if (!session) { redirect("/login") }` block is dead code that adds an unnecessary database round-trip on every profile page load with no security benefit.

Output: profile/page.tsx with auth() kept for session data access but null guard removed. No other files change.
</objective>

<execution_context>
@/Users/davidkwartler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davidkwartler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-e-commerce-shell/02-RESEARCH.md

<interfaces>
<!-- Key types and contracts for this task. Extracted from codebase. -->

From src/lib/auth.ts:
```typescript
export const { handlers, auth, signIn, signOut } = NextAuth({ ... })
// auth() returns: Session | null
// Session shape: { user: { name, email, image, id } }
```

From src/app/(shop)/layout.tsx (already correct — auth gate lives here):
```typescript
export default async function ShopLayout({ children }) {
  const session = await auth()
  if (!session) { redirect("/login") }  // ← this is the definitive guard
  // layout renders nav + children — profile/page.tsx executes AFTER this
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove redundant null guard from profile/page.tsx</name>
  <files>src/app/(shop)/profile/page.tsx</files>
  <action>
    Edit src/app/(shop)/profile/page.tsx to remove the dead-code null guard. The auth() call must stay — it provides session data for the page. Only remove the guard block.

    BEFORE (current state):
    ```typescript
    import { auth } from "@/lib/auth"
    import { redirect } from "next/navigation"

    export default async function ProfilePage() {
      const session = await auth()

      if (!session) {
        redirect("/login")
      }

      const { user } = session
      // ...rest of JSX
    }
    ```

    AFTER (target state):
    ```typescript
    import { auth } from "@/lib/auth"

    export default async function ProfilePage() {
      const session = await auth()
      const { user } = session!  // non-null assertion safe: layout.tsx + proxy.ts guarantee non-null

      // ...rest of JSX unchanged
    }
    ```

    Specific changes:
    1. Remove the `import { redirect } from "next/navigation"` line (no longer used)
    2. Remove the `if (!session) { redirect("/login") }` block (lines 7-9)
    3. Change `const { user } = session` to `const { user } = session!` (non-null assertion documents the layout guarantee)
    4. Leave all JSX and className values exactly as-is — no other changes

    Why: layout.tsx runs auth() and redirects if null BEFORE profile/page.tsx ever executes. The page-level guard is provably unreachable. Removing it eliminates one unnecessary database query per profile page load.

    Using established pattern per research: "auth() for data, NO guard" in child pages of an auth-gated route group.
  </action>
  <verify>
    <automated>cd /Users/davidkwartler/sentinel && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>
    - profile/page.tsx compiles without TypeScript errors
    - The file does NOT contain `redirect("/login")` or `import { redirect }`
    - The file DOES contain `const session = await auth()` and `session!`
    - All JSX output (name, email, avatar display) is unchanged
  </done>
</task>

</tasks>

<verification>
After task completes:
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. The dead-code guard is gone: `grep -n "redirect" src/app/\(shop\)/profile/page.tsx` returns no results
3. The session data access remains: `grep -n "session!" src/app/\(shop\)/profile/page.tsx` returns a result
4. Build succeeds: `npm run build` exits 0
</verification>

<success_criteria>
- SHOP-01: /products page exists with 8 mock products in a responsive grid (already built, no change)
- SHOP-02: /profile page displays name, email, avatar from OAuth session (already built; guard removed, data access preserved)
- Both routes protected by (shop)/layout.tsx auth gate and proxy.ts (no change to these files)
- profile/page.tsx contains no dead-code redirect path — one fewer DB query per profile load
</success_criteria>

<output>
After completion, create `.planning/phases/02-e-commerce-shell/02-01-SUMMARY.md` documenting:
- What was already built (layout, products page, profile page) and its status
- The single change made: removed redundant null guard from profile/page.tsx
- Pattern established: auth() for data in child pages, no guard when layout covers the group
</output>
